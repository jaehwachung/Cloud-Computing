#cloud-config
package_upgrade: true
packages:
  - git
  - python3
  - python3-pip
  - libpq-dev
  - build-essential
write_files:
  - path: "/etc/environment"
    append: true
    content: |
      export VALUT_HOST="<vault_host>"
      export DB_HOST="<db_host>"
      export DB_USER="<db_user>"
      export DB_NAME="<db_name>"
runcmd:
  - python3 -m pip install git+https://github.com/jaehwachung/cloud_computing.git@pgversion
  - create-db
  - shop_manage user-create
  - shop_manage goods-insert
  - waitress-serve knou_shop2.shop_main:app
